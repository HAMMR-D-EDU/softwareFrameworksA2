<main role="main">
  <!-- Header Section -->
  <section class="jumbotron">
    <div class="container">
      <h1 class="jumbotron-heading">Welcome, {{ user?.username }}!</h1>
      <p class="lead text-muted">Role: {{ getPrimaryRole() }}</p>
      <div *ngIf="groupSuccess" class="alert alert-success mt-3">{{ groupSuccess }}</div>
    </div>
  </section>
  
  <!-- My Groups Section -->
  <div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center">
      <h3>My Groups</h3>
      <button *ngIf="canCreateGroups()" class="btn btn-primary" (click)="showCreateGroup = true">
        Create Group
      </button>
    </div>
    <div class="separator"></div>
  </div>

  <!-- Create Group Modal -->
  <div *ngIf="showCreateGroup" class="modal-backdrop" (click)="showCreateGroup = false">
    <div class="modal-dialog" (click)="$event.stopPropagation()">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Create New Group</h5>
          <button type="button" class="btn-close" (click)="showCreateGroup = false" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form (ngSubmit)="createGroup()" id="createGroupForm">
            <div class="mb-3">
              <label class="form-label">Group Name</label>
              <input class="form-control" [(ngModel)]="newGroupName" name="groupName" required>
            </div>
            <div *ngIf="groupError" class="alert alert-danger">{{ groupError }}</div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="showCreateGroup = false">Cancel</button>
          <button type="submit" form="createGroupForm" class="btn btn-primary">Create Group</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Groups Album -->
  <div class="album py-5">
    <div class="container">
      <div *ngIf="groups.length === 0" class="text-center text-muted py-5">
        <h4>No groups yet.</h4>
        <p>{{ canCreateGroups() ? 'Create your first group!' : 'Ask a group admin to add you to a group.' }}</p>
      </div>

      <div class="row">
        <div class="col-md-4" *ngFor="let group of groups">
          <div class="card mb-4 box-shadow">
            <div class="card-body">
              <h5 class="card-title">{{ group.name }}</h5>
              <p class="card-text text-muted">
                Members: {{ group.memberIds.length }} | Admins: {{ group.adminIds.length }}
              </p>
              <div class="d-flex justify-content-between align-items-center">
                <div class="btn-group">
                  <button type="button" class="btn btn-sm btn-outline-secondary" (click)="viewGroup(group.id)">
                    View
                  </button>
                  <button *ngIf="!isSuperAdmin()" type="button" class="btn btn-sm btn-outline-secondary" (click)="leaveGroup(group.id)">
                    Leave
                  </button>
                </div>
                <small class="text-muted">ID: {{ group.id }}</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Browse All Groups Section (Hidden for Super Admins) -->
  <div *ngIf="!isSuperAdmin()">
    <div class="container mt-5">
      <div class="d-flex justify-content-between align-items-center">
        <h3>Browse All Groups</h3>
        <small class="text-muted">Groups you're not a member of</small>
      </div>
      <div class="separator"></div>
    </div>

    <!-- Success/Error Messages for Browse -->
    <div class="container mt-3" *ngIf="browseSuccess || browseError">
      <div *ngIf="browseSuccess" class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="fas fa-check-circle me-2"></i>{{ browseSuccess }}
        <button type="button" class="btn-close" (click)="browseSuccess = ''" aria-label="Close"></button>
      </div>
      <div *ngIf="browseError" class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="fas fa-exclamation-circle me-2"></i>{{ browseError }}
        <button type="button" class="btn-close" (click)="browseError = ''" aria-label="Close"></button>
      </div>
    </div>

    <!-- Available Groups Album -->
    <div class="album py-5 browse-groups-section">
      <div class="container">
        <div *ngIf="availableGroups.length === 0" class="text-center text-muted py-5">
          <i class="fas fa-users fa-3x mb-3"></i>
          <h4>You're already in all groups!</h4>
          <p>There are no other groups available to join.</p>
        </div>

        <div class="row">
          <div class="col-md-4" *ngFor="let group of availableGroups">
            <div class="card mb-4 box-shadow group-card-browse">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-2">
                  <h5 class="card-title mb-0">{{ group.name }}</h5>
                  <span class="badge bg-info">Available</span>
                </div>
                <p class="card-text text-muted mb-3">
                  <i class="fas fa-users me-1"></i>{{ group.memberIds.length }} members
                  <span class="ms-2">
                    <i class="fas fa-shield-alt me-1"></i>{{ group.adminIds.length }} admins
                  </span>
                </p>
                <div class="d-flex justify-content-between align-items-center">
                  <button 
                    type="button" 
                    class="btn btn-primary btn-sm w-100" 
                    (click)="requestToJoinGroup(group.id)">
                    <i class="fas fa-hand-paper me-2"></i>Register Interest
                  </button>
                </div>
                <small class="text-muted d-block mt-2 text-center">
                  Group admins will be notified
                </small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>
